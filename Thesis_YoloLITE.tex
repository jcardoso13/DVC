\chapter{Darknet Lite}
\label{chapter:Darknet}

As mentioned in Section \ref{chapter:DeepVersat}, the Deep Versat system includes a RISC-V CPU to take out generic
code and to write the configuration runs into Versat's memories. This means the first step into implemetning software
that can run any convolutional neural network on this system, it must first run on the CPU then we off load Fixed Functions 
to Versat such as the convolutional layers, maxpool etc.

\section{Porting Darknet to an embedded CPU}

As mentioned in Section \ref{section:darknet} is a framework for Neural Networks on C++ that uses dynamic memory 
and GPU acceleration option to get faster outputs.
Also the use of floats is also prohibited in the embedded code
as the RISC-V CPU only supports the extentions IM. I for Integer and M for multiplication.
It also has a lot of features that are not needed in this work, such as training the CNN.
By stripping the features of darknet we get a much simpler
code framework apropriately named darknet lite.

In the following figure, 
the data strucuture for a layer is showed. A CNN on darknet lite is just an array of layers in which each has an input, 
output and layer parameters. 
Usually the input is a past layer output or the image input.

\lstinputlisting[label=DarknetLiteStrut,language=C++,frame=single,breaklines=true,firstline=1,lastline=38,caption=Layer Struct
  Yolov3~\cite{yolov3}]{./Code/DarknetLiteStrut.h}

By Parsing the .cfg file, a configuration file is written in C with the layer array and static position of the data for each layer. 
Each Layer has it's definition in C to be ran by the embedded CPU but for the sake of this project, several layers can be
replaced by Functions that utilize Versat, the same way that the original Darknet framework had it's functions written for CPU or GPU usage.

In the following figure is an example of a CPU layer that computes the convolutional layer while using Fixed Point Logic.

\lstinputlisting[label=ConvolutionalLayerCPU,language=C++,frame=single,breaklines=true,firstline=54,lastline=85,caption=Convolutional Layer using only CPU and fixed memory]{./Code/convolutional_layer.c}


\section{Conversion of Caffe to CFG}



\section{Parsing CFG Files into the program}